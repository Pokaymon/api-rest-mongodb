<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Editar Club</title>
</head>
<body>
    <h1>Editar Club</h1>

    <form id="formulario-editar-club">
        <label>Nombre del Club:</label>
        <input type="text" id="nombre" required><br><br>

        <label>Entrenador:</label>
        <select id="entrenadorId" required></select><br><br>

        <label>Asociaci√≥n:</label>
        <select id="asociacionId" required></select><br><br>

        <button type="submit">Actualizar Club</button>
    </form>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get("id");

        // Cargar entrenadores en el select
        async function cargarEntrenadores(selectedId) {
            const res = await fetch('/api/entrenadores');
            const entrenadores = await res.json();

            const select = document.getElementById("entrenadorId");
            select.innerHTML = ""; // Limpiar select

            entrenadores.forEach(entrenador => {
                const option = document.createElement("option");
                option.value = entrenador.id;
                option.textContent = entrenador.nombre;
                if (entrenador.id == selectedId) option.selected = true;
                select.appendChild(option);
            });
        }

        // Cargar asociaciones en el select
        async function cargarAsociaciones(selectedId) {
            const res = await fetch('/api/asociaciones');
            const asociaciones = await res.json();

            const select = document.getElementById("asociacionId");
            select.innerHTML = ""; // Limpiar select

            asociaciones.forEach(asociacion => {
                const option = document.createElement("option");
                option.value = asociacion.id;
                option.textContent = asociacion.nombre;
                if (asociacion.id == selectedId) option.selected = true;
                select.appendChild(option);
            });
        }

        async function cargarClub() {
            const response = await fetch(`/api/clubes/${id}`);
            if (response.ok) {
                const club = await response.json();
                document.getElementById("nombre").value = club.nombre;
                await cargarEntrenadores(club.entrenador?.id);
                await cargarAsociaciones(club.asociacion?.id);
            } else {
                alert("Club no encontrado.");
                window.location.href = "listar_clubes.html";
            }
        }

        document.getElementById("formulario-editar-club").addEventListener("submit", async function (e) {
            e.preventDefault();

            const clubActualizado = {
                nombre: document.getElementById("nombre").value,
                entrenador: { id: document.getElementById("entrenadorId").value },
                asociacion: { id: document.getElementById("asociacionId").value }
            };

            const response = await fetch(`/api/clubes/${id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(clubActualizado)
            });

            if (response.ok) {
                alert("Club actualizado correctamente.");
                window.location.href = "listar_clubes.html";
            } else {
                alert("Error al actualizar el club.");
            }
        });

        cargarClub();
    </script>
</body>
</html>

