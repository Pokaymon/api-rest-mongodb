<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Nuevo Club</title>
</head>
<body>
    <h1>Registrar nuevo Club</h1>

    <form id="formulario-club">
        <label>Nombre del Club:</label>
        <input type="text" id="nombre" required><br><br>

        <label>Entrenador:</label>
        <select id="entrenadorId" required></select><br><br>

        <label>Asociación:</label>
        <select id="asociacionId" required></select><br><br>

        <button type="submit">Guardar Club</button>
    </form>

    <script>
        // Cargar entrenadores en el select
        async function cargarEntrenadores() {
            const res = await fetch('/api/entrenadores');
            const entrenadores = await res.json();

            const select = document.getElementById("entrenadorId");
            entrenadores.forEach(entrenador => {
                const option = document.createElement("option");
                option.value = entrenador.id;
                option.textContent = entrenador.nombre; // o `${entrenador.nombre} ${entrenador.apellido}`
                select.appendChild(option);
            });
        }

        // Cargar asociaciones en el select
        async function cargarAsociaciones() {
            const res = await fetch('/api/asociaciones');
            const asociaciones = await res.json();

            const select = document.getElementById("asociacionId");
            asociaciones.forEach(asociacion => {
                const option = document.createElement("option");
                option.value = asociacion.id;
                option.textContent = asociacion.nombre;
                select.appendChild(option);
            });
        }

        // Llamar a ambas funciones al cargar la página
        window.onload = () => {
            cargarEntrenadores();
            cargarAsociaciones();
        };

        // Manejo del formulario
        document.getElementById("formulario-club").addEventListener("submit", async function (e) {
            e.preventDefault();

            const club = {
                nombre: document.getElementById("nombre").value,
                entrenador: { id: document.getElementById("entrenadorId").value },
                asociacion: { id: document.getElementById("asociacionId").value }
            };

            const response = await fetch("/api/clubes", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(club)
            });

            if (response.ok) {
                alert("Club creado correctamente.");
                window.location.href = "listar_clubes.html";
            } else {
                alert("Error al crear el club.");
            }
        });
    </script>
</body>
</html>

