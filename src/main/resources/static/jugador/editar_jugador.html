<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Editar Jugador</title>
</head>
<body>
    <h1>Editar Jugador</h1>
    <form id="form-editar">
        <label>Nombre:</label>
        <input type="text" id="nombre"><br><br>

        <label>Apellido:</label>
        <input type="text" id="apellido"><br><br>

        <label>Dorsal:</label>
        <input type="number" id="dorsal"><br><br>

        <label>Posición:</label>
        <input type="text" id="posicion"><br><br>

        <label>Club:</label>
        <select id="club">
            <option value="">Seleccione un club</option>
        </select><br><br>

        <button type="submit">Actualizar</button>
    </form>

    <button onclick="window.location.href='https://mundialista.ddnsfree.com:8129/jugador/listar_jugadores.html'">
        Regresar
    </button>

    <script>
        const params = new URLSearchParams(window.location.search);
        const id = params.get("id");

        fetch('/api/clubes')
            .then(res => res.json())
            .then(clubes => {
                const select = document.getElementById('club');
                clubes.forEach(club => {
                    const option = document.createElement('option');
                    option.value = club.id;
                    option.textContent = club.nombre;
                    select.appendChild(option);
                });
                return fetch(`/api/jugadores/${id}`);
            })
            .then(res => res.json())
            .then(jugador => {
                document.getElementById("nombre").value = jugador.nombre;
                document.getElementById("apellido").value = jugador.apellido;
                document.getElementById("dorsal").value = jugador.dorsal;
                document.getElementById("posicion").value = jugador.posicion;
                document.getElementById("club").value = jugador.club?.id || '';
            });

        document.getElementById("form-editar").addEventListener("submit", function (event) {
            event.preventDefault();

            const jugadorActualizado = {
                nombre: document.getElementById("nombre").value,
                apellido: document.getElementById("apellido").value,
                dorsal: parseInt(document.getElementById("dorsal").value),
                posicion: document.getElementById("posicion").value,
                club: { id: document.getElementById("club").value }
            };

            fetch(`/api/jugadores/${id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(jugadorActualizado)
            })
            .then(res => {
                if (res.ok) {
                    alert("Jugador actualizado con éxito");
                    window.location.href = "/jugador/listar_jugadores.html";
                } else {
                    alert("Error al actualizar el jugador");
                }
            });
        });
    </script>
</body>
</html>

